angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(a,b){return angular.equals(a,b)}function b(a){return JSON.parse(JSON.stringify(a))}function c(a,b,c){try{return 0>a||a>=t||0>b||b>=t?!1:a+p[c][0]===-1||a+p[c][0]===t?!0:b+p[c][1]===-1||b+p[c][1]===t?!0:!1}catch(d){return!1}}function d(a,b,e){var f=b[e][0],g=b[e][1],h=b[e][2],i=a[f][g][0],j=a[f][g][1];return-1!==i?(h=(q[i][(h+j)%s]+s-j)%s,c(f,g,h)?(b[e][2]=h,b):(b[e][0]=f+p[h][0],b[e][1]=g+p[h][1],b[e][2]=r[h],d(a,b,e))):b}function e(a,b,c,d){var e=b[c][0],h=b[c][1],i=b[c][2];return f(a,e,h,i,d),g(a,b,c,d),d}function f(a,b,d,e,g){if(c(b,d,e))return g;b+=p[e][0],d+=p[e][1],e=r[e];var h=a[b][d][0],i=a[b][d][1],j=e;return e=(q[h][(e+i)%s]+s-i)%s,g.push({row:b,col:d,s0:j,s1:e}),f(a,b,d,e,g)}function g(a,b,d,e){var f=b[d][0],h=b[d][1],i=b[d][2],j=a[f][h][0],k=a[f][h][1];if(-1!==j){var l=i;return i=(q[j][(i+k)%s]+s-k)%s,c(f,h,i)?(e.push({row:f,col:h,s0:l,s1:i}),b[d][2]=i,e):(e.push({row:f,col:h,s0:l,s1:i}),console.log("push: "+e.length),b[d][0]=f+p[i][0],b[d][1]=h+p[i][1],b[d][2]=r[i],g(a,b,d,e))}return e}function h(){var a,b,c=new Array(t);for(a=0;t>a;a++)for(c[a]=new Array(t),b=0;t>b;b++)c[a][b]=[-1,-1];var d=new Array(u);for(a=0;u>a;a++)for(d[a]=new Array(3),b=0;3>b;b++)d[a][b]=-1;return{board:c,token:d}}function i(a,e,f,g,h,i,j){a=b(a),e=b(e);var k={setTurn:{turnIndex:1-j}};if(-1===e[j][0])e[j][0]=f,e[j][1]=g,e[j][2]=i;else{a[f][g][0]=h,a[f][g][1]=i,e=d(a,e,0),e=d(a,e,1);var l=c(e[0][0],e[0][1],e[0][2])&&-1!==a[e[0][0]][e[0][1]][0],m=c(e[1][0],e[1][1],e[1][2])&&-1!==a[e[1][0]][e[1][1]][0];(l===!0||m===!0)&&(k={endMatch:{endMatchScores:[1-l,1-m]}})}return[k,{set:{key:"board",value:a}},{set:{key:"token",value:e}},{set:{key:"delta",value:{row:f,col:g,id:h,rot:i}}},{setRandomInteger:{key:"t0",from:0,to:5}},{setRandomInteger:{key:"t1",from:0,to:5}}]}function j(a,e,f,g,h,i){a[f][g][0]=h,a[f][g][1]=i,e=b(e),e=d(a,e,0),e=d(a,e,1);var j=c(e[0][0],e[0][1],e[0][2])&&-1!==a[e[0][0]][e[0][1]][0],k=c(e[1][0],e[1][1],e[1][2])&&-1!==a[e[1][0]][e[1][1]][0];return a[f][g][0]=-1,a[f][g][1]=-1,[1-j,1-k]}function k(a,c,d){for(var e=[],f=b(c),g=a,h=0;h<d.length;h++){var j=d[h],k=i(f.board,f.token,j.row,j.col,j.id,j.rot,g),l={board:k[1].set.value,token:k[2].set.value,delta:k[3].set.value};e.push({stateBeforeMove:f,stateAfterMove:l,turnIndexBeforeMove:g,turnIndexAfterMove:1-g,move:k,comment:{en:j.comment}}),f=b(l),g=1-g}return e}function l(){return k(0,{board:[[[-1,-1],[-1,-1],[-1,-1]],[[-1,-1],[-1,-1],[-1,-1]],[[-1,-1],[-1,-1],[-1,-1]]],token:[[-1,-1,-1],[-1,-1,-1]],delta:{row:0,col:0,id:0,rot:0}},[{row:2,col:1,id:0,rot:5,comment:"player0 put token0 at the board edge"},{row:0,col:0,id:0,rot:0,comment:"player1 put token1 at the board edge"},{row:2,col:1,id:1,rot:5,comment:"player0 put tile1 at 2x1 with rotation 5"},{row:0,col:0,id:4,rot:0,comment:"player1 put tile4 at 0x0 with rotation 0"},{row:2,col:2,id:0,rot:0,comment:"player0 put tile0 at 2x2 with rotation 0"},{row:0,col:1,id:1,rot:5,comment:"player1 put tile1 at 0x1 with rotation 5"},{row:1,col:2,id:2,rot:1,comment:"player0 put tile2 at 1x2 with rotation 1"},{row:1,col:1,id:0,rot:1,comment:"player1 put tile0 at 1x1 with rotation 1"},{row:0,col:2,id:3,rot:2,comment:"to win the game, player0 put a tile to move token1 reach the board edge"}])}function m(b){var d=b.move,e=b.turnIndexBeforeMove,f=b.stateBeforeMove;try{var g=d[3].set.value,j=g.row,k=g.col,l=g.id,m=g.rot,n=f.board,o=f.token,p=f.t0,q=f.t1;if(void 0===n||void 0===o){var r=h();n=r.board,o=r.token}if(-1===o[e][0]){if(c(j,k,m)===!1)return!1;if(j===o[1-e][0]&&k===o[1-e][1]&&m===o[1-e][2])return!1}else{if(-1!==n[j][k][0])return!1;if(o[e][0]!==j||o[e][1]!==k)return!1;if(l!==p&&l!==q)return!1}var s=i(n,o,j,k,l,m,e);if(!a(d,s))return!1}catch(t){return!1}return!0}function n(a,b){return Math.floor((b-a)*Math.random())+a}function o(a,b,d,e){var f,g,h,k=b[e][0],l=b[e][1],m=b[e][2];if(-1===k){var o=[];for(f=0;t>f;f+=t-1)for(g=0;t>g;g++)if(f!==b[1-e][0]||g!==b[1-e][1])for(h=0;s>h;h++)c(f,g,h)&&o.push([f,g,h]);for(g=0;t>g;g+=t-1)for(f=1;t-1>f;f++)if(f!==b[1-e][0]||g!==b[1-e][1])for(h=0;s>h;h++)c(f,g,h)&&o.push([f,g,h]);var p=n(0,o.length);return k=o[p][0],l=o[p][1],m=o[p][2],i(a,b,k,l,0,m,e)}var q=0;m=0;for(var r=-2,u=0;u<d.length;u++)for(var v=0;s>v;v++){var w=j(a,b,k,l,d[u],v),x=2*w[e]-1+(1-w[1-e]);x>r&&(q=d[u],m=v,r=x)}return i(a,b,k,l,q,m,e)}var p=[[0,-1],[-1,0],[-1,1],[0,1],[1,0],[1,-1]],q=[[1,0,3,2,5,4],[1,0,4,5,2,3],[1,0,5,4,3,2],[2,4,0,5,1,3],[3,4,5,0,1,2]],r=[3,4,5,0,1,2],s=6,t=4,u=2,v=5;return{isMoveOk:m,getExampleGame:l,createMove:i,getInitialBoard:h,boardSize:t,tileNum:v,isEdge:c,createComputerMove:o,getTokenPath:e}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","gameService","stateService","gameLogic","hexagon","resizeGameAreaService",function(a,b,c,d,e,f,g,h){"use strict";function i(a){b.info(["Making move:",a]),d.makeMove(a)}function j(){i(f.createComputerMove(a.board,a.token,a.tid,a.turnIndex))}function k(b){if(a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,console.log("updateUI "+a.turnIndex),a.endMatchScores=b.endMatchScores,a.jsonState=angular.toJson(b.stateAfterMove,!0),a.board=b.stateAfterMove.board,a.token=b.stateAfterMove.token,a.tid[0]=b.stateAfterMove.t0,a.tid[1]=b.stateAfterMove.t1,a.tidIdx=0,a.delta=b.stateAfterMove.delta,console.log("tileid: "+a.tid[0]+" "+a.tid[1]),void 0===a.board){var d=f.getInitialBoard();a.board=d.board,a.token=d.token}else for(var e=0;e<a.board.length;e++)for(var h=0;h<a.board[0].length;h++)if(-1!==a.board[e][h][0]){var i=a.board[e][h][0],k=a.board[e][h][1];g.drawPathTile(a.tileLs[e][h],i,k)}a.drawTile();var l;if(void 0!==b.stateBeforeMove&&null!==b.stateBeforeMove){var m=b.stateBeforeMove.token;for(l=0;2>l;l++)if(void 0!==m&&-1!==m[l][0]){var n=[];n=f.getTokenPath(a.board,m,l,n),a.pathLs[l]=[];for(var o=0;o<n.length;o++){var p=n[o];a.pathLs[l].push(g.drawPath(p.row,p.col,p.s0,p.s1))}}}for(console.log("endMatchScores:"+a.endMatchScores),l=0;2>l;l++)if(-1!==a.token[l][0]){var q=a.token[l][0],r=a.token[l][1],s=a.token[l][2];a.tokenLs[l]=void 0!==a.endMatchScores&&0===a.endMatchScores[l]?g.genToken(q,r,s):g.genToken(q,r,s)}a.turnIndex>=0&&-1!==a.token[a.turnIndex][0]&&(a.putToken=!1),a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(a.isYourTurn=!1,c(j,500))}h.setWidthToHeight(.833),a.mouseClick=function(c,d,e){if(console.log("Clicked "+c+" "+d+" "+e),a.isYourTurn)try{if(void 0!==a.token&&-1===a.token[a.turnIndex][0]&&f.isEdge(c,d,e)){var g=f.createMove(a.board,a.token,c,d,0,e,a.turnIndex);a.isYourTurn=!1,i(g)}}catch(h){return void b.info(["Cell is already full in position:",a.token[a.turnIndex][0],a.token[a.turnIndex][1]])}},a.drawTile=function(){if(a.isYourTurn&&void 0!==a.token&&-1!==a.token[a.turnIndex][0]){var b=a.token[a.turnIndex][0],c=a.token[a.turnIndex][1];a.currTile=g.genTile(b,c),g.drawPathTile(a.currTile,a.tid[a.tidIdx],a.rot)}},a.selTile=function(){if(!a.isYourTurn)return void console.log("not your turn");try{void 0!==a.token&&-1!==a.token[a.turnIndex][0]&&(a.tidIdx=(a.tidIdx+1)%2,a.rot=0,a.drawTile())}catch(c){return void b.info(["Cell is already full in position:",a.token[a.turnIndex][0],a.token[a.turnIndex][1]])}},a.turnTile=function(){if(a.isYourTurn)try{void 0!==a.token&&-1!==a.token[a.turnIndex][0]&&(a.rot=(a.rot+1)%g.sideNum,a.drawTile())}catch(c){return void b.info(["Cell is already full in position:",a.token[a.turnIndex][0],a.token[a.turnIndex][1]])}},a.makeMove=function(){if(a.isYourTurn)try{var c=a.token[a.turnIndex][0],d=a.token[a.turnIndex][1],e=f.createMove(a.board,a.token,c,d,a.tid[a.tidIdx],a.rot,a.turnIndex);b.info(["Making move:",e]),a.isYourTurn=!1,i(e)}catch(g){return void b.info(["Cell is already full in position:",a.token[a.turnIndex][0],a.token[a.turnIndex][1]])}},a.tid=[0,0],a.tidIdx=0,a.rot=0,a.putToken=!0,g.init(20,20,60),a.tileLs=g.genTileLs(f.getInitialBoard().board),a.tokenLs=[],a.pathLs=[[],[]],k({stateAfterMove:{},turnIndexAfterMove:0,yourPlayerIndex:-2}),d.setGame({gameDeveloperEmail:"angieyayabird@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,exampleGame:f.getExampleGame(),isMoveOk:f.isMoveOk,updateUI:k})}]);
//# sourceMappingURL=everything.min.js.map
angular.module("myApp",["ngTouch","ui.bootstrap"]).factory("gameLogic",function(){"use strict";function a(a,b){return angular.equals(a,b)}function b(a){return angular.copy(a)}function c(a,b,c){try{return 0>a||a>=t||0>b||b>=t?!1:a+p[c][0]===-1||a+p[c][0]===t?!0:b+p[c][1]===-1||b+p[c][1]===t?!0:!1}catch(d){return!1}}function d(a,b,e){var f=b[e][0],g=b[e][1],h=b[e][2],i=a[f][g][0],j=a[f][g][1];return-1!==i?(h=(q[i][(h+j)%s]+s-j)%s,c(f,g,h)?(b[e][2]=h,b):(b[e][0]=f+p[h][0],b[e][1]=g+p[h][1],b[e][2]=r[h],d(a,b,e))):b}function e(a,b,c,d){var e=b[c][0],h=b[c][1],i=b[c][2];return f(a,e,h,i,d),g(a,b,c,d),d}function f(a,b,d,e,g){if(c(b,d,e))return g;b+=p[e][0],d+=p[e][1],e=r[e];var h=a[b][d][0],i=a[b][d][1],j=e;return e=(q[h][(e+i)%s]+s-i)%s,g.push({row:b,col:d,s0:j,s1:e}),f(a,b,d,e,g)}function g(a,b,d,e){var f=b[d][0],h=b[d][1],i=b[d][2],j=a[f][h][0],k=a[f][h][1];if(-1!==j){var l=i;return i=(q[j][(i+k)%s]+s-k)%s,c(f,h,i)?(e.push({row:f,col:h,s0:l,s1:i}),b[d][2]=i,e):(e.push({row:f,col:h,s0:l,s1:i}),console.log("push: "+e.length),b[d][0]=f+p[i][0],b[d][1]=h+p[i][1],b[d][2]=r[i],g(a,b,d,e))}return e}function h(){var a,b,c=[];for(a=0;t>a;a++)for(c[a]=[],b=0;t>b;b++)c[a][b]=[-1,-1];var d=[];for(a=0;u>a;a++)for(d[a]=[],b=0;3>b;b++)d[a][b]=-1;return{board:c,token:d}}function i(a,e,f,g,h,i,j){a=b(a),e=b(e);var k={setTurn:{turnIndex:1-j}};if(-1===e[j][0])e[j][0]=f,e[j][1]=g,e[j][2]=i;else{a[f][g][0]=h,a[f][g][1]=i,e=d(a,e,0),e=d(a,e,1);var l=c(e[0][0],e[0][1],e[0][2])&&-1!==a[e[0][0]][e[0][1]][0],m=c(e[1][0],e[1][1],e[1][2])&&-1!==a[e[1][0]][e[1][1]][0];(l===!0||m===!0)&&(k={endMatch:{endMatchScores:[1-l,1-m]}})}return[k,{set:{key:"board",value:a}},{set:{key:"token",value:e}},{set:{key:"delta",value:{row:f,col:g,id:h,rot:i}}},{setRandomInteger:{key:"t0",from:0,to:5}},{setRandomInteger:{key:"t1",from:0,to:5}}]}function j(a,e,f,g,h,i){a[f][g][0]=h,a[f][g][1]=i,e=b(e),e=d(a,e,0),e=d(a,e,1);var j=c(e[0][0],e[0][1],e[0][2])&&-1!==a[e[0][0]][e[0][1]][0],k=c(e[1][0],e[1][1],e[1][2])&&-1!==a[e[1][0]][e[1][1]][0];return a[f][g][0]=-1,a[f][g][1]=-1,[1-j,1-k]}function k(a,c,d){for(var e=[],f=b(c),g=a,h=0;h<d.length;h++){var j=d[h],k=i(f.board,f.token,j.row,j.col,j.id,j.rot,g),l={board:k[1].set.value,token:k[2].set.value,delta:k[3].set.value};e.push({stateBeforeMove:f,stateAfterMove:l,turnIndexBeforeMove:g,turnIndexAfterMove:1-g,move:k,comment:{en:j.comment}}),f=b(l),g=1-g}return e}function l(){return k(0,{board:[[[-1,-1],[-1,-1],[-1,-1]],[[-1,-1],[-1,-1],[-1,-1]],[[-1,-1],[-1,-1],[-1,-1]]],token:[[-1,-1,-1],[-1,-1,-1]],delta:{row:0,col:0,id:0,rot:0}},[{row:2,col:1,id:0,rot:5,comment:"player0 put token0 at the board edge"},{row:0,col:0,id:0,rot:0,comment:"player1 put token1 at the board edge"},{row:2,col:1,id:1,rot:5,comment:"player0 put tile1 at 2x1 with rotation 5"},{row:0,col:0,id:4,rot:0,comment:"player1 put tile4 at 0x0 with rotation 0"},{row:2,col:2,id:0,rot:0,comment:"player0 put tile0 at 2x2 with rotation 0"},{row:0,col:1,id:1,rot:5,comment:"player1 put tile1 at 0x1 with rotation 5"},{row:1,col:2,id:2,rot:1,comment:"player0 put tile2 at 1x2 with rotation 1"},{row:1,col:1,id:0,rot:1,comment:"player1 put tile0 at 1x1 with rotation 1"},{row:0,col:2,id:3,rot:2,comment:"to win the game, player0 put a tile to move token1 reach the board edge"}])}function m(b){var d=b.move,e=b.turnIndexBeforeMove,f=b.stateBeforeMove;try{var g=d[3].set.value,j=g.row,k=g.col,l=g.id,m=g.rot,n=f.board,o=f.token,p=f.t0,q=f.t1;if(void 0===n||void 0===o){var r=h();n=r.board,o=r.token}if(-1===o[e][0]){if(c(j,k,m)===!1)return!1;if(j===o[1-e][0]&&k===o[1-e][1]&&m===o[1-e][2])return!1}else{if(-1!==n[j][k][0])return!1;if(o[e][0]!==j||o[e][1]!==k)return!1;if(l!==p&&l!==q)return!1}var s=i(n,o,j,k,l,m,e);if(!a(d,s))return!1}catch(t){return!1}return!0}function n(a,b){return Math.floor((b-a)*Math.random())+a}function o(a,b,d,e){var f,g,h,k=b[e][0],l=b[e][1],m=b[e][2];if(-1===k){var o=[];for(f=0;t>f;f+=t-1)for(g=0;t>g;g++)if(f!==b[1-e][0]||g!==b[1-e][1])for(h=0;s>h;h++)c(f,g,h)&&o.push([f,g,h]);for(g=0;t>g;g+=t-1)for(f=1;t-1>f;f++)if(f!==b[1-e][0]||g!==b[1-e][1])for(h=0;s>h;h++)c(f,g,h)&&o.push([f,g,h]);var p=n(0,o.length);return k=o[p][0],l=o[p][1],m=o[p][2],i(a,b,k,l,0,m,e)}var q=0;m=0;for(var r=-2,u=0;u<d.length;u++)for(var v=0;s>v;v++){var w=j(a,b,k,l,d[u],v),x=2*w[e]-1+(1-w[1-e]);x>r&&(q=d[u],m=v,r=x)}return i(a,b,k,l,q,m,e)}var p=[[0,-1],[-1,0],[-1,1],[0,1],[1,0],[1,-1]],q=[[1,0,3,2,5,4],[1,0,4,5,2,3],[1,0,5,4,3,2],[2,4,0,5,1,3],[3,4,5,0,1,2]],r=[3,4,5,0,1,2],s=6,t=4,u=2,v=5;return{isMoveOk:m,getExampleGame:l,createMove:i,getInitialBoard:h,boardSize:t,tileNum:v,isEdge:c,createComputerMove:o,getTokenPath:e}}),angular.module("myApp").controller("Ctrl",["$rootScope","$scope","$log","$timeout","gameService","stateService","gameLogic","hexagon","resizeGameAreaService",function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){c.info(["Making move:",a]),e.makeMove(a)}function k(){j(g.createComputerMove(b.board,b.token,b.tid,b.turnIndex))}function l(a){if(b.isYourTurn=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,b.turnIndex=a.turnIndexAfterMove,console.log("updateUI "+b.turnIndex),b.endMatchScores=a.endMatchScores,b.jsonState=angular.toJson(a.stateAfterMove,!0),b.board=a.stateAfterMove.board,b.token=a.stateAfterMove.token,b.tid[0]=a.stateAfterMove.t0,b.tid[1]=a.stateAfterMove.t1,b.tidIdx=0,b.delta=a.stateAfterMove.delta,console.log("tileid: "+b.tid[0]+" "+b.tid[1]),void 0===b.board){var c=g.getInitialBoard();b.isHelpModalShown=!1,b.board=c.board,b.token=c.token,b.tileLs=h.genTileLs(c.board),b.tokenLs=[],b.pathLs=[[],[]],b.tid=[0,0],b.tidIdx=0,b.rot=0,b.putToken=!0,b.currTile=null}else for(var e=0;e<b.board.length;e++)for(var f=0;f<b.board[0].length;f++)if(-1!==b.board[e][f][0]){var i=b.board[e][f][0],j=b.board[e][f][1];h.drawPathTile(b.tileLs[e][f],i,j)}console.log(b.board[0][0]),b.drawTile();var l;if(void 0!==a.stateBeforeMove&&null!==a.stateBeforeMove){var m=a.stateBeforeMove.token;for(l=0;2>l;l++)if(void 0!==m&&-1!==m[l][0]){var n=[];n=g.getTokenPath(b.board,m,l,n),b.pathLs[l]=[];for(var o=0;o<n.length;o++){var p=n[o];b.pathLs[l].push(h.drawPath(p.row,p.col,p.s0,p.s1))}}}for(console.log("endMatchScores:"+b.endMatchScores),l=0;2>l;l++)if(-1!==b.token[l][0]){var q=b.token[l][0],r=b.token[l][1],s=b.token[l][2];b.tokenLs[l]=void 0!==b.endMatchScores&&null!==b.endMatchScores&&0===b.endMatchScores[l]?h.genToken(q,r,s):h.genToken(q,r,s)}b.turnIndex>=0&&-1!==b.token[b.turnIndex][0]&&(b.putToken=!1),b.isYourTurn&&""===a.playersInfo[a.yourPlayerIndex].playerId&&(b.isYourTurn=!1,d(k,500))}i.setWidthToHeight(.8),a.isHelpModalShown=!1,b.mouseClick=function(a,d,e){if(console.log("Clicked "+a+" "+d+" "+e),b.isYourTurn)try{if(void 0!==b.token&&-1===b.token[b.turnIndex][0]&&g.isEdge(a,d,e)){var f=g.createMove(b.board,b.token,a,d,0,e,b.turnIndex);b.isYourTurn=!1,j(f)}}catch(h){return void c.info(["Cell is already full in position:",b.token[b.turnIndex][0],b.token[b.turnIndex][1]])}},b.drawTile=function(){if(b.isYourTurn&&void 0!==b.token&&-1!==b.token[b.turnIndex][0]){var a=b.token[b.turnIndex][0],c=b.token[b.turnIndex][1];b.currTile=h.genTile(a,c),h.drawPathTile(b.currTile,b.tid[b.tidIdx],b.rot)}},b.selTile=function(){if(!b.isYourTurn)return void console.log("not your turn");try{void 0!==b.token&&-1!==b.token[b.turnIndex][0]&&(b.tidIdx=(b.tidIdx+1)%2,b.rot=0,b.drawTile())}catch(a){return void c.info(["Cell is already full in position:",b.token[b.turnIndex][0],b.token[b.turnIndex][1]])}},b.turnTile=function(){if(b.isYourTurn)try{void 0!==b.token&&-1!==b.token[b.turnIndex][0]&&(b.rot=(b.rot+1)%h.sideNum,b.drawTile())}catch(a){return void c.info(["Cell is already full in position:",b.token[b.turnIndex][0],b.token[b.turnIndex][1]])}},b.makeMove=function(){if(b.isYourTurn)try{var a=b.token[b.turnIndex][0],d=b.token[b.turnIndex][1],e=g.createMove(b.board,b.token,a,d,b.tid[b.tidIdx],b.rot,b.turnIndex);c.info(["Making move:",e]),b.isYourTurn=!1,j(e)}catch(f){return void c.info(["Cell is already full in position:",b.token[b.turnIndex][0],b.token[b.turnIndex][1]])}},b.tid=[0,0],b.tidIdx=0,b.rot=0,b.putToken=!0;var m=document.getElementById("svg");b.getFontSize=function(){return m.clientWidth/15},h.init(40,15,60),b.tileLs=h.genTileLs(g.getInitialBoard().board),b.tokenLs=[],b.pathLs=[[],[]],e.setGame({gameDeveloperEmail:"angieyayabird@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,exampleGame:g.getExampleGame(),isMoveOk:g.isMoveOk,updateUI:l})}]),angular.module("myApp").factory("hexagon",["gameLogic",function(a){"use strict";function b(a,b,d){j=a,k=b,l=d,m=Math.sqrt(3)*l,n=2*l,o=1.5*l,u=6,p=[n/2,m/2],q=[],q[0]=[0,m/2],q[1]=[n-o,0],q[2]=[o,0],q[3]=[n,m/2],q[4]=[o,m],q[5]=[n-o,m],t=[];for(var e=0;u>e;e++)t[e]=[(q[e][0]+q[(e+1)%u][0])/2,(q[e][1]+q[(e+1)%u][1])/2];r=c(q),s=[[1,0,3,2,5,4],[1,0,4,5,2,3],[1,0,5,4,3,2],[2,4,0,5,1,3],[3,4,5,0,1,2]]}function c(a){for(var b="",c=0;c<a.length;c++)c>0&&(b+=" "),b=b+a[c][0]+","+a[c][1];return b}function d(a,b){var c={r:a,c:b,tx:j+b*o,ty:k+b*m/2+m*a,pathLs:[],edgeLs:[],points:r};return c}function e(b){for(var e=[],f=0;f<b.length;f++){e.push([]);for(var g=0;g<b[0].length;g++){for(var h=d(f,g),i=0;u>i;i++)if(a.isEdge(f,g,i)){var j=[q[i],q[(i+1)%u],p],k={points:c(j),s:i};h.edgeLs.push(k)}e[f].push(h)}}return e}function f(a,b,c){for(var d=0;u>d;d++){var e=d,f=s[b][d];e=(e+u-c)%u,f=(f+u-c)%u,a.pathLs.push(h(a.r,a.c,e,f))}return a}function g(a){return"M"+t[a.ss][0]+","+t[a.ss][1]+" A"+a.r+","+a.r+" 0 0,1 "+t[a.se][0]+","+t[a.se][1]}function h(a,b,c,d){var e,f,h,i,n,p=Math.abs(d-c);if(1===p||5===p)(c+1)%u===d?(e=d,f=c):(e=c,f=d),n={ss:e,se:f,ctr:q[e],r:l/2,arc:[1/3*Math.PI*f,2/3*Math.PI+1/3*Math.PI*f]},n.str=g(n);else if(2===p||4===p){(c+2)%u===d?(e=c,f=(e+1)%u,h=d,i=c):(e=d,f=(e+1)%u,h=c,i=d);var r=q[f][0]+q[f][0]-q[e][0],s=q[f][1]+q[f][1]-q[e][1];n={ss:h,se:i,ctr:[r,s],r:3*l/2,arc:[1/3*Math.PI*f,1/3*Math.PI*f+1/3*Math.PI]},n.str=g(n)}else 3===p&&(d>c?(h=c,i=d):(h=d,i=c),n={ss:h,se:i},n.str="M"+t[n.ss][0]+","+t[n.ss][1]+" L"+t[n.se][0]+","+t[n.se][1]);return n.r=a,n.c=b,n.tx=j+b*o,n.ty=k+b*m/2+m*a,n}function i(a,b,c){var d={r:a,c:b,s:c,tx:j+b*o,ty:k+b*m/2+m*a,pt:t[c]};return d}var j,k,l,m,n,o,p,q,r,s,t,u=6;return{init:b,genTile:d,genTileLs:e,drawPathTile:f,genToken:i,drawPath:h,sideNum:u}}]);
//# sourceMappingURL=everything.min.js.map